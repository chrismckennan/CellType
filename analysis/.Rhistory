C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 0.7, 1)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 0.7, 1)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 0.7, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15/10
v.sigma.sim <- 0.03^2/10
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)/2
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15/10
v.sigma.sim <- 0.03^2/10
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim*10, d.sim)/2
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
sigma.B.sim
sigma.L.sim
0.075/sqrt(0.15)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15/50
v.sigma.sim <- 0.03^2/50
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim*50, d.sim)/5
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
sigma.B.sim
sigma.L.sim
0.4747971 * 0.15
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 0.7, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+2, B.sim, L.sim)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
sigma.B.sim
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
sigma.B.sim[1] <- 0
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.10
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
#alpha.cell.sim <- (alpha.cell.sim) * Omega.sim[2,1] * (1 - Omega.sim[2,1]) / Omega.sim[3,1] / (1 - Omega.sim[3,1]) - 1
sigma.L.sim <- c(0.19, 0.19, 1) / c(Omega.sim[1:2,3], Omega.QL[3,1]) * sqrt(0.15)
#sigma.L.sim <- c(0.19, 0.19, 0.19)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
sqrt(var.cell) * (0.8) * 0.2
sqrt(var.cell * (0.8) * 0.2)
sqrt(var.cell * (0.94) * 0.06)
0.8/sqrt(var.cell * (0.8) * 0.2)
0.06 / sqrt(var.cell * (0.94) * 0.06)
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 2     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[1:K.sim, 1:(d.sim+1)]
alpha.cell.sim <- (1/var.cell - 1)
sigma.L.sim <- c(1, 1, 1) / Omega.QL[1:3,1] * sqrt(0.15)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
##Analyze data with and without cell type data##
#No cell type info#
#conf.nocell.sim <- est.confounder.num(~Cov1 + Cov2, X.data=data.sim, Y=t(M.sim), method="ed", bcv.plot = T, rmax=10); r.nocell.sim <- conf.nocell.sim$r
analyzed.data <- AnalyzeData(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
names(anlayzed.data)
names(analyzed.data)
qvalue(analyzed.data$cate.nocell$beta.p.value[,2])$pi0
analyzed.data$q.nocell$pi0
analyzed.data$q.cell$pi0
names(analyzed.data$q.nocell)
hist(analyzed.data$q.nocell$pvalues)
hist(analyzed.data$q.cell$pvalues)
L.sim[1,]
L.sim[2,]
L.sim[3,]
length(which(L.sim[,3]!=0))/p
length(which(L.sim[,2]!=0))/p
length(which(L.sim[,1]!=0))/p
tmp.bop <- solve(t(X.sim)%*%X.sim) %*% t(X.sim)
dim(C.sim)
dim(tmp.bop)
tmp.bop %*% t(C.sim)
tmp.bop %*% C.sim
Omega.som
Omega.sim
t(Omega.sim)
tmp.bop %*% C.sim
r.sim
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 1     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[,-2]
Omega.sim
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[,-c(2,4)]
Omega.sim
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 1     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[,-c(2,4)]
alpha.cell.sim <- (1/var.cell - 1)
sigma.L.sim <- c(1, 1, 1) / Omega.QL[1:3,1] * sqrt(0.15)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Cov2", "Tcells", "Eos", "Neutro")
dim(B.sim)
source("chunk-options.R")
source("../R/OptimizeLogLike.R")
source("../R/OptimizeLogLike_Ksigma.R")
source("../R/SimSparseData.R")
source("../R/EstimateBeta.R")
source("../R/CrudeEstDim.R")
source("../R/AnalyzeSimResults.R")
n.sim <- 100   #Number of individuals
r.sim <- 5     #Number of additional confounders
K.sim <- 3     #Number of cell types
d.sim <- 1     #Number of interesting covariates (either 0 or 1)
pi0.B.sim <- rep(0.95, d.sim)    #Sparsity in B
pi0.L.sim <- c(1, 1, 0.7)    #Sparsity in L
LB.ind <- 1     #Are L and B independent? If no, the confounder Eos will have nonzero effects on the same sites as B[nonzero,1]
mu.sigma.sim <- 0.15
v.sigma.sim <- 0.03^2
beta.sigma <- mu.sigma.sim/v.sigma.sim
alpha.sigma <- beta.sigma * mu.sigma.sim     #Sigma ~ Gamma(alpha.sigma, beta.sigma)
sigma.B.sim <- rep(mu.sigma.sim, d.sim)
Omega.sim <- Omega.QL
Omega.sim[1,3] <- 0.04
Omega.sim[2,3] <- 0.02
Omega.sim <- Omega.sim[,-c(2,4)]
alpha.cell.sim <- (1/var.cell - 1)
sigma.L.sim <- c(1, 1, 1) / Omega.QL[1:3,1] * sqrt(0.15)
sigma.r.sim <- c(0.15, 0.15, 0.15, 0.15, 0.15)
##Simulate Data##
SimData <- Sim.Data(n.sim, r.sim, p, pi0.B.sim, pi0.L.sim, LB.ind, sigma.B.sim, sigma.L.sim, sigma.r.sim, Omega.sim, alpha.cell.sim, alpha.sigma, beta.sigma)
M.sim <- SimData$M.sim
X.sim <- SimData$X.sim
L.sim <- SimData$L.sim
B.sim <- SimData$B.sim
Sigma.sim <- SimData$Sigma.sim
Gamma.sim <- SimData$Gamma.sim
C.sim <- SimData$C.sim    #n x K.all matrix
data.sim <- data.frame(cbind(X.sim, C.sim))
colnames(data.sim) <- c("Intercept", "Cov1", "Tcells", "Eos", "Neutro")
Omega.sim
analyzed.data <- AnalyzeData2(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
source("chunk-options.R")
source("../R/OptimizeLogLike.R")
source("../R/OptimizeLogLike_Ksigma.R")
source("../R/SimSparseData.R")
source("../R/EstimateBeta.R")
source("../R/CrudeEstDim.R")
source("../R/AnalyzeSimResults.R")
analyzed.data <- AnalyzeData2(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
dim(B.sim)
source("chunk-options.R")
source("../R/OptimizeLogLike.R")
source("../R/OptimizeLogLike_Ksigma.R")
source("../R/SimSparseData.R")
source("../R/EstimateBeta.R")
source("../R/CrudeEstDim.R")
source("../R/AnalyzeSimResults.R")
analyzed.data <- AnalyzeData2(M.sim, data.sim, r.sim, r.sim+1, B.sim, L.sim)
X.sim
